{
  "entities": {
    "GameSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GameSession",
      "type": "object",
      "description": "Represents a single game session, containing all data required for a multiplayer match.",
      "properties": {
        "gameCode": {
          "type": "string",
          "description": "Unique, user-friendly code for joining the game session."
        },
        "creatorId": {
            "type": "string",
            "description": "The Firebase UID of the user who created the game."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the game session was created.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The current status of the game session.",
          "enum": ["waiting", "in_progress", "completed"]
        },
        "indicators": {
          "type": "object",
          "description": "The shared state of the nation's indicators.",
          "properties": {
            "economy": { "type": "number" },
            "education": { "type": "number" },
            "wellBeing": { "type": "number" },
            "popularSupport": { "type": "number" },
            "hunger": { "type": "number" },
            "militaryReligion": { "type": "number" }
          }
        },
        "boardPosition": {
            "type": "number",
            "description": "Current position of the nation on the game board."
        },
        "players": {
            "type": "object",
            "description": "A map of player objects, where the key is the player's Firebase UID.",
            "patternProperties": {
                "^[a-zA-Z0-9_]+$": {
                    "$ref": "#/entities/Player"
                }
            }
        },
        "turn": {
            "type": "number",
            "description": "The current turn number of the game."
        },
        "currentPlayerIndex": {
            "type": "number",
            "description": "The index in the players array indicating whose turn it is."
        },
        "currentCardId": {
            "type": "string",
            "description": "The ID of the decision card currently in play."
        },
        "logs": {
            "type": "array",
            "description": "A history of all actions taken in the game.",
            "items": {
                "$ref": "#/entities/LogEntry"
            }
        }
      },
      "required": [ "gameCode", "creatorId", "createdAt", "status", "indicators", "players", "turn", "currentPlayerIndex" ]
    },
    "Player": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Player",
      "type": "object",
      "description": "Represents a player within a game session. This is a sub-object, not a separate collection.",
      "properties": {
        "id": { "type": "string", "description": "Player's Firebase UID." },
        "name": { "type": "string", "description": "The player's chosen display name." },
        "role": { "type": "string", "description": "The character role assigned to the player." },
        "capital": { "type": "number", "description": "The amount of private capital the player has." },
        "isOpportunist": { "type": "boolean", "description": "Secret objective flag." },
        "avatar": { "type": "string", "description": "Identifier for the player's avatar image."}
      },
      "required": [ "id", "name", "role", "capital", "isOpportunist", "avatar" ]
    },
     "LogEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LogEntry",
      "type": "object",
      "description": "Represents a single entry in the game's event log. This is a sub-object.",
      "properties": {
        "id": { "type": "number", "description": "A unique identifier for the log entry (timestamp-based)." },
        "turn": { "type": "number" },
        "playerName": { "type": "string" },
        "playerRole": { "type": "string" },
        "decision": { "type": "string", "description": "The name of the decision made." },
        "effects": { "type": "string", "description": "A summary of the effects of the decision." }
      },
      "required": ["id", "turn", "playerName", "playerRole", "decision", "effects"]
    }
  },
  "auth": {
    "providers": [
      "anonymous"
    ]
  },
  "firestore": {
     "structure": [
      {
        "path": "/game_sessions/{gameCode}",
        "definition": {
          "entityName": "GameSession",
          "schema": {
            "$ref": "#/entities/GameSession"
          },
          "description": "Stores the entire state for a single game session. The document ID is the user-friendly join code.",
          "params": [
            {
              "name": "gameCode",
              "description": "Unique user-friendly code for the game session."
            }
          ]
        }
      }
    ],
    "reasoning": "The data model has been consolidated into a single collection, `game_sessions`, where each document represents an entire game. This is a significant change from a multi-collection structure to a single-document-per-game model. This design is highly effective for self-contained, session-based applications like this board game. \n\n1.  **Atomicity and Simplicity**: By storing all data for a single game (players, indicators, logs, etc.) in one document, updates become atomic at the game level. A single `updateDoc` call can modify player capital, national indicators, and add a log entry simultaneously. This drastically simplifies transaction logic. \n2.  **Simplified Security Rules**: Security is vastly simplified. The primary rule is: 'Can the user access this `game_sessions/{gameCode}` document?' Access is granted if the user's UID is in the `players` map within that same document. There's no need for cross-collection `get()` calls in the rules, which is more performant and less error-prone. \n3.  **Real-time Efficiency**: The client application only needs to subscribe to a single document (`useDoc`) to get all necessary real-time updates for the entire game. This is more efficient than managing multiple listeners for different collections (players, nation_state, etc.). \n4.  **Scalability**: While there's a 1MB limit per document, a text-based game like this is highly unlikely to approach that limit. The number of games can scale indefinitely as it's just adding new documents. This structure scales well with the number of concurrent games."
  }
}
